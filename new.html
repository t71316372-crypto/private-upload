<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>二人だけの記録空間</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: #fdfaf7; color: #444; }
.card { background: #fff; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
select, textarea { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #eee; margin-bottom: 10px; box-sizing: border-box; }
button { width: 100%; padding: 12px; border-radius: 20px; border: none; background: #a78bfa; color: white; cursor: pointer; }
.msg { background: #fef2f2; padding: 10px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid #fca5a5; }
.name-tag { font-size: 0.8rem; color: #8b5cf6; font-weight: bold; }
</style>
</head>
<body>
<h1>二人だけの記録空間</h1>
<div class="card">
<select id="nameSelect"><option value="まさ">まさ</option><option value="パートナー">パートナー</option></select>
<textarea id="chatInput" placeholder="メッセージを入力"></textarea>
<button id="sendBtn">残しておく</button>
<div id="chatLog" style="margin-top:20px;"></div>
</div>
<script>
const URL = "https://erdwkchgsewnzkyriypx.supabase.co";
const KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVyZHdrY2hnc2V3bnpreXJpeXB4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5Nzc0MTEsImV4cCI6MjA3OTU1MzQxMX0.YU29PyeeZbW-Hj1Q3FZUSWc2RpfodUEk0DXb9kKj1W8";
const sb = window.supabase.createClient(URL, KEY);
async function load() {
const { data, error } = await sb.from('messages').select('*').order('created_at', { ascending: false });
if (error) return;
document.getElementById("chatLog").innerHTML = data.map(m => `<div class="msg"><div class="name-tag">${m.sender_name || 'だれか'}</div>${m.text}</div>`).join("");
}
document.getElementById("sendBtn").onclick = async () => {
const t = document.getElementById("chatInput").value;
const n = document.getElementById("nameSelect").value;
if (!t) return;
const { error } = await sb.from('messages').insert([{ text: t, sender_name: n }]);
if (error) { alert("エラー: " + error.message); } else { document.getElementById("chatInput").value = ""; load(); }
};
load();
</script>
</body>
</html>
