<div class="card">
  <h2>今の気持ち</h2>
  <select id="nameSelect" style="font-family: inherit; padding: 5px; border-radius: 10px; margin-bottom: 10px;">
    <option value="自分">自分</option>
    <option value="相手の名前">相手の名前</option>
  </select>
  
  <textarea id="chatInput" placeholder="ここになんでも書いてね"></textarea>
  <button id="sendBtn">残しておく</button>
  
  <div id="chatLog"></div>
</div>

<script>
  // --- JavaScriptの保存処理の部分 ---
  sendBtn.onclick = async () => {
    const text = chatInput.value.trim();
    const userName = document.getElementById("nameSelect").value; // 名前を取得
    
    if (!text) return;

    // 名前と一緒にSupabaseに保存
    const { error } = await sb
      .from('messages')
      .insert([{ 
        content: text,
        name: userName // ここで名前を保存
      }]);

    if (error) {
      alert("保存に失敗しました");
    } else {
      chatInput.value = "";
      loadMessages(); // 読み込み直す
    }
  };

  // --- 表示する部分も名前に対応させる ---
  function renderMessage(msg) {
    const msgDiv = document.createElement("div");
    msgDiv.className = "msg";
    
    // 「名前：メッセージ」という形で表示
    msgDiv.innerHTML = `
      <div style="font-size: 0.7rem; color: #8b5cf6; margin-bottom: 3px;">${msg.name || '不明'}</div>
      <div>${msg.content}</div>
    `;
    
    chatLog.appendChild(msgDiv);
  }
</script>
