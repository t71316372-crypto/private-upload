<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>二人の声</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Zen+Kurenaido&display=swap" rel="stylesheet">
<style>
body { font-family: "Zen Kurenaido", serif; max-width: 600px; margin: 0 auto; padding: 20px; background: #fdfaf7; color: #444; }
h1 { text-align: center; font-weight: normal; }
.nav-box { text-align: center; margin-bottom: 20px; }
.nav-link { color: #8b5cf6; text-decoration: none; font-size: 1.1rem; }
.audio-card { background: #fff; padding: 15px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
.file-name { font-size: 0.9rem; color: #8b5cf6; margin-bottom: 8px; font-weight: bold; }
audio { width: 100%; height: 40px; }
</style>
</head>
<body>
<h1>二人の声</h1>
<div class="nav-box">
  <a href="index.html" class="nav-link">← 記録空間に戻る</a>
</div>

<div id="audioList">読み込み中...</div>

<script>
(function() {
  const p = "https://";
  const d = "erdwkchgsewnzkyriypx";
  const s = ".supabase.co";
  const finalUrl = p + d + s;
  const finalKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVyZHdrY2hnc2V3bnpreXJpeXB4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5Nzc0MTEsImV4cCI6MjA3OTU1MzQxMX0.YU29PyeeZbW-Hj1Q3FZUSWc2RpfodUEk0DXb9kKj1W8";

  const sb = window.supabase.createClient(finalUrl, finalKey);

  async function loadAudio() {
    // 'voice'バケットからファイル一覧を取得
    const { data, error } = await sb.storage.from('voice').list('', { limit: 100, order: { column: 'created_at', ascending: false } });
    
    if (error) {
      document.getElementById('audioList').innerText = "読み込みエラー";
      return;
    }

    const list = document.getElementById('audioList');
    list.innerHTML = "";

    data.forEach(file => {
      // 公開URLを取得
      const { data: { publicUrl } } = sb.storage.from('voice').getPublicUrl(file.name);
      
      const div = document.createElement('div');
      div.className = 'audio-card';
      div.innerHTML = `
        <div class="file-name">${file.name}</div>
        <audio controls src="${publicUrl}"></audio>
      `;
      list.appendChild(div);
    });
    
    if (data.length === 0) list.innerText = "声の記録はまだありません。";
  }

  loadAudio();
})();
</script>
</body>
</html>
