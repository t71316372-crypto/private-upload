<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>二人のアルバム</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Zen+Kurenaido&display=swap" rel="stylesheet">
<style>
body { font-family: "Zen Kurenaido", serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #fdfaf7; color: #444; }
h1 { text-align: center; font-weight: normal; }
.nav-box { text-align: center; margin-bottom: 20px; }
.nav-link { color: #8b5cf6; text-decoration: none; font-size: 1.1rem; }
.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
.img-card { background: #fff; padding: 5px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
.img-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 8px; cursor: pointer; }
</style>
</head>
<body>
<h1>二人のアルバム</h1>
<div class="nav-box">
  <a href="index.html" class="nav-link">← 記録空間に戻る</a>
</div>

<div id="imageGrid" class="grid">読み込み中...</div>

<script>
(function() {
  const p = "https://";
  const d = "erdwkchgsewnzkyriypx";
  const s = ".supabase.co";
  const finalUrl = p + d + s;
  const finalKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVyZHdrY2hnc2V3bnpreXJpeXB4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5Nzc0MTEsImV4cCI6MjA3OTU1MzQxMX0.YU29PyeeZbW-Hj1Q3FZUSWc2RpfodUEk0DXb9kKj1W8";

  const sb = window.supabase.createClient(finalUrl, finalKey);

  async function loadImages() {
    // 'photos'バケットからファイル一覧を取得
    const { data, error } = await sb.storage.from('photos').list('', { limit: 100, order: { column: 'created_at', ascending: false } });
    
    if (error) {
      document.getElementById('imageGrid').innerText = "読み込みエラー";
      return;
    }

    const grid = document.getElementById('imageGrid');
    grid.innerHTML = "";

    data.forEach(file => {
      // 公開URLを取得
      const { data: { publicUrl } } = sb.storage.from('photos').getPublicUrl(file.name);
      
      const div = document.createElement('div');
      div.className = 'img-card';
      div.innerHTML = `<img src="${publicUrl}" onclick="window.open('${publicUrl}')">`;
      grid.appendChild(div);
    });
    
    if (data.length === 0) grid.innerText = "写真はまだありません。";
  }

  loadImages();
})();
</script>
</body>
</html>
